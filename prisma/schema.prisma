generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid()) @db.Uuid
  email     String    @unique
  password  String
  image     String
  status    Boolean   @default(true)
  createdAt DateTime
  type      String
  accounts  Account[]
  admin     Admin?
  client    Client?
  vendor    Vendor?
}

model Role {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  description String
  admins      Admin[]
  permissions Permission[] @relation("RolePermissions")
}

model Permission {
  id          Int    @id @default(autoincrement())
  name        String @unique
  description String
  roles       Role[] @relation("RolePermissions")
}

model Account {
  id                 String    @id @default(uuid()) @db.Uuid
  userId             String    @db.Uuid
  provider           String
  providerAccountId  String
  refreshToken       String?
  accessToken        String?
  accessTokenExpires DateTime?
  user               User      @relation(fields: [userId], references: [id])

  @@unique([provider, providerAccountId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Category {
  id          Int               @id @default(autoincrement())
  name        String            @unique
  description String
  status      Boolean
  icon        String            @default("")
  posts       Post[]
  features    CategoryFeature[] @relation("CategoryFeatures")
}

model CategoryFeature {
  id           Int           @id @default(autoincrement())
  name         String
  type         String
  required     Boolean
  icon         String
  values       String
  onCard       Boolean
  rank         Int
  inFilter     Boolean
  postFeatures PostFeature[]
  categories   Category[]    @relation("CategoryFeatures")
}

model Post {
  id          Int           @id @default(autoincrement())
  title       String
  description String
  createdAt   DateTime
  status      String
  categoryId  Int
  vendorId    Int
  location    String        @default("Kigali")
  category    Category      @relation(fields: [categoryId], references: [id])
  vendor      Vendor        @relation(fields: [vendorId], references: [id])
  features    PostFeature[]
  images      PostImage[]
  likes       PostLike[]
  packages    PostPackage[]
  price       PostPrice?
  reviews     PostReview[]
}

model PostFeature {
  id                Int             @id @default(autoincrement())
  value             String
  categoryFeatureId Int
  postId            Int
  categoryFeature   CategoryFeature @relation(fields: [categoryFeatureId], references: [id])
  post              Post            @relation(fields: [postId], references: [id])
}

model PostImage {
  id     Int    @id @default(autoincrement())
  url    String
  name   String
  postId Int
  post   Post   @relation(fields: [postId], references: [id])
}

model PostPrice {
  id       Int    @id @default(autoincrement())
  min      Float
  max      Float
  currency String
  postId   Int    @unique
  post     Post   @relation(fields: [postId], references: [id])
}

model PostPackage {
  id          Int    @id @default(autoincrement())
  name        String
  description String
  price       Float
  postId      Int
  post        Post   @relation(fields: [postId], references: [id])
}

model PostReview {
  id        Int      @id @default(autoincrement())
  content   String
  type      String
  createdAt DateTime
  postId    Int
  clientId  Int
  client    Client   @relation(fields: [clientId], references: [id])
  post      Post     @relation(fields: [postId], references: [id])
}

model PostLike {
  id        Int      @id @default(autoincrement())
  createdAt DateTime
  postId    Int
  clientId  Int
  client    Client   @relation(fields: [clientId], references: [id])
  post      Post     @relation(fields: [postId], references: [id])
}

model Service {
  id          Int    @id @default(autoincrement())
  name        String
  description String
}

model Vendor {
  id       Int             @id @default(autoincrement())
  name     String
  status   Boolean
  userId   String          @unique @db.Uuid
  posts    Post[]
  user     User            @relation(fields: [userId], references: [id])
  contacts VendorContact[]
}

model ContactType {
  id          Int             @id @default(autoincrement())
  name        String
  type        String
  description String
  contacts    VendorContact[]
}

model VendorContact {
  id            Int         @id @default(autoincrement())
  value         String
  vendorId      Int
  contactTypeId Int
  contactType   ContactType @relation(fields: [contactTypeId], references: [id])
  vendor        Vendor      @relation(fields: [vendorId], references: [id])
}

model Client {
  id           Int                 @id @default(autoincrement())
  phone        String
  userId       String              @unique @db.Uuid
  name         String
  user         User                @relation(fields: [userId], references: [id])
  subscription ClientSubscription?
  likedPosts   PostLike[]
  reviews      PostReview[]
}

model Subscription {
  id                  Int                  @id @default(autoincrement())
  name                String               @unique
  price               Int
  description         String
  clientSubscriptions ClientSubscription[]
}

model ClientSubscription {
  id             Int           @id @default(autoincrement())
  createdAt      DateTime
  updatedAt      DateTime
  expiryAt       DateTime
  clientId       Int           @unique
  subscriptionId Int
  client         Client        @relation(fields: [clientId], references: [id])
  subscription   Subscription  @relation(fields: [subscriptionId], references: [id])
  transactions   Transaction[]
}

model Transaction {
  id                   Int                @id @default(autoincrement())
  price                Int
  quantity             Int
  amount               Int
  proof                String             @default("")
  createdAt            DateTime
  updatedAt            DateTime
  status               String
  clientSubscriptionId Int
  payNumber            String
  transactionMethod    String
  clientSubscription   ClientSubscription @relation(fields: [clientSubscriptionId], references: [id])
}

model Admin {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime
  roleId    Int
  userId    String   @unique @db.Uuid
  role      Role     @relation(fields: [roleId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}
